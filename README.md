# Seclens — LLM Security Scanner (GitHub‑style UI, Hugging Face powered)

Scan any **public GitHub repository** for security issues using a free **Hugging Face Inference** model.  
Seclens presents findings in a clean, GitHub‑like interface with an **Issues** list, a **Code** viewer that shows a focused **10‑line** snippet, and **Quick Fix** suggestions generated by the model.

---

## 🔗 Live Link (add later)


**https://llm-security-scanner-beryl.vercel.app/** 

---

## 📌 What this project is
- A full‑stack Next.js app that pulls code from GitHub, analyzes it with an LLM on **Hugging Face Inference**, and displays results.
- Goal: **simple, free‑friendly** security scanning with a professional UX and clearly actionable hints.

### What I used
- **Framework/UI:** Next.js (App Router), React 18, TypeScript, Tailwind CSS, lucide‑react
- **Code Viewer:** `@monaco-editor/react` (Monaco)
- **Source Access:** Octokit (GitHub REST API)
- **LLM:** Hugging Face Inference API (e.g., `Qwen/Qwen2.5-Coder-1.5B-Instruct`)
- **Validation:** zod (for structured JSON responses)
- **Storage:** in‑memory cache keyed by `repo@commit` (portable on free hosting)

---

## 🧭 How it works (high‑level flow)

1. **User inputs a repo** (`owner/name`) and hits **Scan**.
2. **API /scan** resolves the HEAD commit, lists tree entries (filters out binaries/build artifacts), fetches file contents (capped by size), and sends chunks to the **Hugging Face** model.
3. The model returns **structured JSON** (validated with zod) describing findings: title, severity, file path, line range, description, and recommendation.
4. Findings are keyed and cached as **`scan:repo@commit`** for quick retrieval.
5. The **Issues** view shows a GitHub‑style list with severity labels, filters, and deep links to the exact lines on GitHub.
6. Selecting an issue opens the **Code** view with:
   - A **10‑line** slice centered on the finding (or the first 10 lines if the finding is longer).
   - A **persistent highlight** (content + gutter + overview ruler) on the issue line(s).
7. The **Quick Fix** panel asks the model for **1–2 minimal suggestions**, each with steps and a small snippet/diff if helpful.

---

## 🧩 Implementation details

### UI/UX
- **Header** with repo input and **Scan** button (GitHub‑style dark bar).
- **Issues pane**: severity badges, file path+line range, **View code** and **Open in GitHub** actions.
- **Code pane** (sticky right): Monaco editor shows *real file line numbers* using an offset.  
  We compute a 10‑line window around the finding and map absolute → local slice lines.
- **Persistent highlight**:
  - Uses Monaco **decorations collection** so the highlight survives focus/cursor changes.
  - Disables default current‑line glow to avoid masking.
  - Adds **gutter stripe** + **overview ruler** mark for strong visual cues.

### Backend
- **/api/scan**:  
  - Resolves commit (Octokit), lists tree, fetches raw file contents, caps bytes per file.  
  - Calls **Hugging Face** with a structured prompt asking for JSON only.  
  - Validates with zod, dedupes by ID, caches by `repo@commit`.
- **/api/file**: returns raw file contents for the viewer.
- **/api/fix**: asks the model for **1–2 “quick fixes”** with steps and an optional snippet/diff.

### Key choices
- **Free‑first**: no paid services required. Hugging Face Inference token is free to obtain.
- **Reproducibility**: every scan is tied to a specific **commit SHA** with deep links.
- **Safety**: we never write back to GitHub; suggestions are non‑destructive and local.

---

## 🛠️ Local setup

### Prerequisites
- **Node.js 18+** (18/20 LTS recommended)
- **npm** (or pnpm/yarn)
- **Hugging Face API token** (free): https://huggingface.co/settings/tokens

### Install
```bash
npm install
```

### Environment
Create `.env.local` in the project root:

```ini
# Optional but helpful for GitHub API rate limits
GITHUB_TOKEN=

# Hugging Face configuration (required)
LLM_PROVIDER=hf
HUGGINGFACE_API_KEY=
HF_MODEL=Qwen/Qwen2.5-Coder-1.5B-Instruct

# Scanner tuning
SCAN_STRICT_DIRS=false
MAX_FILES=80
MAX_BYTES_PER_FILE=120000
```

### Run
```bash
npm run dev
# open http://localhost:3000
```

---

## 🚀 Deploy (Vercel)

```bash
npm i -g vercel
vercel login
vercel link --yes --name seclens   # or your preferred name

# Add env vars (Production); repeat for Preview if desired
vercel env add GITHUB_TOKEN production
vercel env add LLM_PROVIDER production          # hf
vercel env add HUGGINGFACE_API_KEY production
vercel env add HF_MODEL production              # e.g. Qwen/Qwen2.5-Coder-1.5B-Instruct
vercel env add SCAN_STRICT_DIRS production     # false
vercel env add MAX_FILES production            # 80
vercel env add MAX_BYTES_PER_FILE production   # 120000

# Deploy
vercel --yes --name seclens       # Preview URL
vercel --prod --yes --name seclens
```

> After deploying, update the **Live Link** section with your production URL.

---

## 🧪 What I implemented (notable points)

- **Commit‑pinned scans**: each result references `repo @ commit` and provides “Open in GitHub” links with `#Lstart` anchors.
- **10‑line code slices** with accurate **line numbers** (using offset mapping).
- **Persistent highlights** via Monaco decorations, gutter stripe, and overview ruler marks.
- **Model‑driven Quick Fixes** that return a minimal set of steps/snippets to try immediately.
- **Strict JSON parsing** and **zod validation** to keep the UI stable even when the model is verbose.

---

## 🐞 Problems I faced & how I solved them

- **GitHub rate limits (403)**  
  *Symptom:* API errors on larger repos.  
  *Fix:* Add a free `GITHUB_TOKEN` in `.env.local` and redeploy; cap files/bytes, add retries where appropriate.

- **Monaco highlight disappearing on focus/cursor moves**  
  *Symptom:* Highlight only on the current line, vanishes on click.  
  *Fix:* Use **decorations collection**, disable Monaco’s `renderLineHighlight`, and add gutter/ruler decorations.

- **Centering a fixed 10‑line window**  
  *Symptom:* Edge cases when the finding is near file start/end or spans >10 lines.  
  *Fix:* Window math ensures exactly 10 lines, centering when possible, or top‑padding/bottom‑padding at edges.

- **Hugging Face JSON response variability**  
  *Symptom:* Some models wrap JSON inside arrays or return strings.  
  *Fix:* Robust parsing that handles `array[0].generated_text`, raw string JSON, or objects, then **zod** validation.

- **Next.js App Router styling not applied**  
  *Symptom:* UI looked unstyled.  
  *Fix:* Ensure `app/layout.tsx` imports `./globals.css` and Tailwind content globs include `app/` (or `src/app/`).

- **Windows dev quirks** (cache/artifact noise)  
  *Symptom:* Stale `.next/` cache causing inconsistent hot reloads.  
  *Fix:* Clear cache (`rm -rf .next`), restart server; keep dependencies minimal and pinned.

---

## ⚙️ Performance notes

- **Caps** (`MAX_FILES`, `MAX_BYTES_PER_FILE`) protect the model from huge payloads.
- **Selective directories** with `SCAN_STRICT_DIRS` can avoid scanning vendor/build folders.
- **In‑memory cache** keyed by `repo@commit` prevents re‑analysis on refresh.

---

## 🗺️ Future enhancements (efficiency & large codebases)

**Scale & Speed**
- **Background scans** (Vercel Background Functions / Upstash QStash) with UI polling.
- **Parallel fetch + concurrency caps** when reading files and calling the model.
- **HTTP caching**: GitHub **ETags / If‑None‑Match**, exponential backoff on 403.
- **Streaming UI**: show findings incrementally as they’re produced.

**Accuracy & Signal**
- **Prompt orchestration** to split large repos into **targeted chunks** (per language/sink).
- **Embeddings‑based clustering/deduplication** to reduce noise.
- Enrich prompts with **taint analysis hints** and codebase metadata.

**Developer UX**
- **Unified diff** preview (“Propose fix”) with Monaco Diff or `react-diff-viewer-continued`.
- **Create PR** flow via GitHub API.
- **Ignore patterns** + **Settings** pane (file globs, caps, directories, model).

**Security & Ops**
- **GitHub OAuth** to scan private repositories.
- **Observability**: Sentry for errors + basic metrics (files scanned, duration).
- **Secret redaction** in logs/UI by default.

---

## 🧰 Troubleshooting quick hits

- **No output / empty findings** → verify `HUGGINGFACE_API_KEY`, `HF_MODEL`, and network limits; try a different public repo.
- **UI looks plain** → ensure Tailwind is configured and `globals.css` is imported by `app/layout.tsx`.
- **Highlight missing** → confirm CodeViewer decoration CSS and `renderLineHighlight: "none"` setting.
- **Build OK locally, fails on Vercel** → recheck Project Settings → Environment Variables for Production.

---

## 📜 License
MIT (or your preferred license). Add a `LICENSE` file if you plan to open‑source.

---

## 🙌 Credits
- Next.js, Monaco Editor, Tailwind CSS, Octokit  
- LLM analysis & quick fixes via **Hugging Face Inference**
